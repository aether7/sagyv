{% extends "panel_control.html" %}
{% load static %}

{% block content %}
    <section id="liquidacion" data-ng-app="liquidacionApp" data-ng-controller="LiquidacionController as liquidacion">
        <section class="panel-busqueda">
            <label for="">Numero guía:</label>
            <input type="text" value="" data-ng-model="liquidacion.numeroGuia" />
            <button class="btn btn-primary" data-ng-click="liquidacion.buscarGuia()">Buscar</button>
        </section>

        <section>
            <div>
                <label for="lista_vehiculos" >Vehículo:</label>
                <select name="lista_vehiculos" id="lista_vehiculos" data-ng-model="liquidacion.idVehiculo">
                    {% for vehiculo in vehiculos %}
                    <option value="{{ vehiculo.id }}">{{ vehiculo.numero }} - {{ vehiculo.patente }}</option>
                    {% endfor %}
                </select>
            </div>

            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Código</th>
                        <th>Cantidad en Tránsito</th>
                        <th>Vacíos</th>
                        <th>Llenos</th>
                        <th>Precio Unitario</th>
                        <th>Cantidad a pagar</th>
                    </tr>
                </thead>
                <tbody>
                    {% verbatim %}
                    <tr data-ng-repeat="producto in liquidacion.productos"
                        data-ng-controller="ProductoController as productoCtrl">
                        <td>{{ producto.codigo }}</td>
                        <td>{{ producto.cantidad }}</td>
                        <td>
                            <input type="text" value="{{ producto.vacios }}" data-ng-model="producto.vacios" />
                        </td>
                        <td>{{ productoCtrl.calcularRestante(producto) }}</td>
                        <td>{{ producto.precio | currency }}</td>
                        <td style="text-align:right">
                            {{ productoCtrl.calcularPrecio(producto) | currency }}
                        </td>
                    </tr>
                    <tr class="fila-desglose">
                        <td colspan="5">Subtotal</td>
                        <td>{{ vc.calcularSubTotal() | currency }}</td>
                    </tr>
                    <tr class="fila-desglose">
                        <td colspan="5">Descuentos</td>
                        <td>{{ vc.descuentos | currency }}</td>
                    </tr>
                    <tr class="fila-desglose">
                        <td colspan="5">TOTAL</td>
                        <td>{{ vc.calcularTotal() | currency }}</td>
                    </tr>
                    {% endverbatim %}
                </tbody>
            </table>
        </section>
    </section>
{% endblock %}

{% block js %}
<script src="{% static 'js/vendor/angular.min.js' %}"></script>
<script src="{% static 'js/plugins/typeahead.min.js' %}"></script>
<script src="{% static 'js/controllers/liquidacion_controller.js' %}"></script>
<script>
    App.urls.set("liquidacion:obtener_guia", "{% url 'liquidacion:obtener_guia' %}");
</script>
{% endblock %}
