{% extends "panel_control.html" %}
{% load static %}

{% block content %}
    <input id="balance_liquidacion" type="hidden" value="{% url 'balance_liquidacion' %}" />

    <section class="container">
        <article class="pull-right">
            Guía # : <input id="guia_despacho" type="text" value="" />
        </article>

        <article class="pull-right">
            <input id="busca_trabajador" type="search" value="" placeholder="Nombre trabajador" />
            <span class="glyphicon glyphicon-search"></span>
        </article>
    </section>

    <section class="container" style="margin-top:4em">
        <article class="row">

            <div id="stock_inicial" class="col-md-4 list-group">
                {% for producto in productos %}
                    <a href="javascript:;" class="list-group-item" data-cantidad="{{producto.stock}}">
                        {{ producto.codigo }} - {{ producto.tipo_producto.nombre }} ({{ producto.peso }} Kg)
                        <span class="badge" id="id_initial_{{producto.id}}">{{ producto.stock }}</span>
                    </a>
                {% endfor %}
            </div>

            <div id="stock_actual" class="col-md-4 list-group">
                {% for producto in productos %}
                    <a href="javascript:;" class="list-group-item"
                        onclick="App.liquidacionController.showModal({{ producto.id }})"
                        data-cantidad="0" data-id="{{ producto.id }}" data-producto="true">
                        {{ producto.codigo }} - {{ producto.tipo_producto.nombre }} ({{ producto.peso }} Kg)
                        <span class="badge" id="id_actual_{{ producto.id }}">0</span>
                    </a>
                {% endfor %}
            </div>

            <div id="stock_gastado" class="col-md-4">
                {% for producto in productos %}
                    <a href="javascript:;" class="list-group-item" data-cantidad="0">
                        {{ producto.codigo }} - {{ producto.tipo_producto.nombre }} ({{ producto.peso }} Kg)
                        <span class="badge" id="id_gastado_{{ producto.id }}">0</span>
                    </a>
                {% endfor %}
            </div>
        </article>

        <section class="container" style="margin-top:4em">
            <form action="" method="post" role="form">
                <table class="table table-stripped">
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Cantidad en tránsito</th>
                            <th>LLenos</th>
                            <th>Vacíos</th>
                            <th>Total pagar</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for producto in productos %}
                        {% if producto.stock > 0 %}
                        <tr>
                            <td>{{ producto.codigo }}</td>
                            <td>{{ producto.stock }}</td>
                            <td><input type="text" value="" placeholder="cantidad llena" /></td>
                            <td><input type="text" value="" placeholder="cantidad vacíos" /></td>
                            <td><span>$ 5000</span></td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
            </form>
        </section>

        <article class="row center">
            <button id="btn_guardar_liquidacion" class="btn btn-primary">Guardar</button>
        </article>
    </section>

    <div id="modal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Cantidad utilizada</h4>
                </div>

                <div class="modal-body">
                    <div class="form-group">
                        <label class="control-label" for="cantidad">Cantidad:</label>
                        <input id="cantidad" type="text" class="form-control" />
                        <span class="help-block"></span>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    <button id="btn_actualizar_venta" type="button" class="btn btn-primary">Guardar</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block js %}
<script src="{% static 'js/plugins/typeahead.min.js' %}"></script>
<script src="{% static 'js/controllers/liquidacion.js' %}"></script>
<script>
    App.liquidacionController = new App.Controllers.Liquidacion();

    {% for trabajador in trabajadores %}
        App.liquidacionController.addTrabajador("{{ trabajador }}");
    {% endfor %}

    App.liquidacionController.init();
</script>
{% endblock %}
